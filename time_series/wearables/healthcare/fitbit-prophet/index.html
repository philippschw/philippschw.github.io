<!DOCTYPE html>
<html lang="en">
<head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link href="https://fonts.googleapis.com/css?family=Merriweather:300|Raleway:400,700" rel="stylesheet">
<link rel="stylesheet" href="/assets/css/style.css">
<title>Fitbit activity and sleep data: a time-series analysis with Generalized Additive Models</title>
<meta name="og:title" content="Philipp Schwarz"/>
<meta name="og:description" content="Machine Learning Engineer & Data Scientist  with strong statistical  modeling and programming skills. I prefer working in a high-performance environment and in an interdisciplinary team. Reach out to me if you got a project that is unprecedented, and you need a pragmatic guy that delivers."/>
<meta property="og:image" content="/assets/portfolio.png"/>
<meta property="og:url" content="/"/></head>
<body>
	<main class="container">
		<section class="about">
			<a href="/"><img src="/assets/portfolio.png" alt="Philipp Schwarz"></a>
			<h2><a href="/" style="text-decoration: none">Philipp Schwarz</a></h2>
			<p class="tagline">Data Scientist</p>
			<ul class="social"><a href="https://github.com/philippschw"><li><i class="icon-github-circled"></i></li></a><a href="https://www.linkedin.com/in/philippschw"><li><i class="icon-linkedin-squared"></i></li></a><a href="https://twitter.com/philippschw"><li><i class="icon-twitter-squared"></i></li></a></ul>
			<p>&copy; 2020</p>
		</section>
		<section class="content">
			<div class="post-container">
  <a class="post-link" href="/time_series/wearables/healthcare/fitbit-prophet/">
    <h2 class="post-title">Fitbit activity and sleep data: a time-series analysis with Generalized Additive Models</h2>
  </a>
  <div class="post-meta">
    <ul class="post-categories"><li>time_series</li><li>wearables</li><li>healthcare</li></ul>
    <div class="post-date"><i class="icon-calendar"></i>Apr 1, 2018</div>
  </div>
  <div class="post">
    <p>The goal of this notebook is to provide an analysis of the time-series data from a user of a fitbit tracker throughout a year. I will use this data to predict an additional year of the life of the user using <a href="https://en.wikipedia.org/wiki/Generalized_additive_model">Generalized Additive Models</a>.</p>

<p><a href="https://algo-data.quora.com/Data-sets-of-any-type-some-links">Data source</a>: <a href="https://drive.google.com/open?id=0Bx4yoK5aogTSbGJ2WlkwYjlHejQ">Activity</a>, <a href="https://drive.google.com/open?id=0Bx4yoK5aogTSMUFqRjVNcko5WlU">Sleep</a></p>

<p>Packages used:</p>
<ul>
  <li>pandas, numpy, matplotlib, seaborn</li>
  <li><a href="https://github.com/facebook/prophet">Prophet</a></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">fbprophet</span> <span class="kn">import</span> <span class="n">Prophet</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="n">sns</span>

<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</code></pre></div></div>

<h2 id="data-cleaning-missing-data-and-outliers">Data cleaning (missing data and outliers)</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># import the activity data</span>
<span class="n">activity</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'OneYearFitBitData.csv'</span><span class="p">)</span>
<span class="c"># change commas to dots</span>
<span class="n">activity</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">activity</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">','</span><span class="p">,</span><span class="s">'.'</span><span class="p">)))</span>
<span class="c"># change column names to English</span>
<span class="n">activity</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s">'Date'</span><span class="p">,</span> <span class="s">'BurnedCalories'</span><span class="p">,</span> <span class="s">'Steps'</span><span class="p">,</span> <span class="s">'Distance'</span><span class="p">,</span> <span class="s">'Floors'</span><span class="p">,</span> <span class="s">'SedentaryMinutes'</span><span class="p">,</span> <span class="s">'LightMinutes'</span><span class="p">,</span> <span class="s">'ModerateMinutes'</span><span class="p">,</span> <span class="s">'IntenseMinutes'</span><span class="p">,</span> <span class="s">'IntenseActivityCalories'</span><span class="p">]</span>
<span class="c"># import the sleep data</span>
<span class="n">sleep</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'OneYearFitBitDataSleep.csv'</span><span class="p">)</span>
<span class="c"># check the size of the dataframes</span>
<span class="n">activity</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">sleep</span><span class="o">.</span><span class="n">shape</span>
<span class="c"># merge dataframes</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">activity</span><span class="p">,</span> <span class="n">sleep</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s">'outer'</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s">'Date'</span><span class="p">)</span>
<span class="c"># parse date into correct format</span>
<span class="n">data</span><span class="p">[</span><span class="s">'Date'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">'Date'</span><span class="p">],</span> <span class="n">format</span><span class="o">=</span><span class="s">'</span><span class="si">%</span><span class="s">d-</span><span class="si">%</span><span class="s">m-</span><span class="si">%</span><span class="s">Y'</span><span class="p">)</span>
<span class="c"># correct units for Calories and Steps</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="s">'BurnedCalories'</span><span class="p">,</span> <span class="s">'Steps'</span><span class="p">,</span> <span class="s">'IntenseActivityCalories'</span><span class="p">]:</span>
    <span class="n">data</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">*</span><span class="mi">1000</span>
</code></pre></div></div>

<p>Once imported, we should check for any missing data:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># check for missing data</span>
<span class="n">data</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Date                       0
BurnedCalories             0
Steps                      0
Distance                   0
Floors                     0
SedentaryMinutes           0
LightMinutes               0
ModerateMinutes            0
IntenseMinutes             0
IntenseActivityCalories    0
MinutesOfSleep             5
MinutesOfBeingAwake        5
NumberOfAwakings           5
LengthOfRestInMinutes      5
dtype: int64
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># check complete rows where sleep data is missing</span>
<span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">'MinutesOfSleep'</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">())[</span><span class="mi">0</span><span class="p">],:]</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Date</th>
      <th>Burned Calories</th>
      <th>Steps</th>
      <th>Distance</th>
      <th>Floors</th>
      <th>Sedentary Minutes</th>
      <th>Light Minutes</th>
      <th>Moderate Minutes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015-05-08</th>
      <td>1934.0</td>
      <td>905000.0</td>
      <td>0.65</td>
      <td>0.0</td>
      <td>1.355</td>
      <td>46.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2016-02-01</th>
      <td>2986.0</td>
      <td>11426.0</td>
      <td>8.52</td>
      <td>12.0</td>
      <td>911.000</td>
      <td>192.0</td>
      <td>48.0</td>
    </tr>
    <tr>
      <th>2016-02-02</th>
      <td>2974.0</td>
      <td>10466.0</td>
      <td>7.78</td>
      <td>13.0</td>
      <td>802.000</td>
      <td>152.0</td>
      <td>48.0</td>
    </tr>
    <tr>
      <th>2016-02-03</th>
      <td>3199.0</td>
      <td>12866.0</td>
      <td>9.63</td>
      <td>11.0</td>
      <td>767.000</td>
      <td>271.0</td>
      <td>45.0</td>
    </tr>
    <tr>
      <th>2016-02-04</th>
      <td>2037.0</td>
      <td>2449.0</td>
      <td>1.87</td>
      <td>0.0</td>
      <td>821.000</td>
      <td>80.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Date</th>
      <th>Intense Minutes</th>
      <th>Intense Activity Calories</th>
      <th>Minutes Of Sleep</th>
      <th>Minutes Of Being Awake</th>
      <th>Number Of Awakings</th>
      <th>Length Of Rest In Minutes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015-05-08</th>
      <td>0.0</td>
      <td>168000.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2016-02-01</th>
      <td>43.0</td>
      <td>1478.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2016-02-02</th>
      <td>48.0</td>
      <td>1333.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2016-02-03</th>
      <td>28.0</td>
      <td>1703.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2016-02-04</th>
      <td>0.0</td>
      <td>337000.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>

<p>We can see that the sleep information was missing for some dates. The activity information for those days is complete. Therefore, we should not get rid of those rows just now.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># check rows for which steps count is zero</span>
<span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">'Steps'</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">],:]</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Date</th>
      <th>Burned Calories</th>
      <th>Steps</th>
      <th>Distance</th>
      <th>Floors</th>
      <th>Sedentary Minutes</th>
      <th>Light Minutes</th>
      <th>Moderate Minutes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015-12-23</th>
      <td>1789.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.44</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2016-03-13</th>
      <td>1790.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.44</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2016-03-28</th>
      <td>1790.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.44</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Date</th>
      <th>Intense Minutes</th>
      <th>Intense Activity Calories</th>
      <th>Minutes Of Sleep</th>
      <th>Minutes Of Being Awake</th>
      <th>Number Of Awakings</th>
      <th>Length Of Rest In Minutes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015-12-23</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2016-03-13</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2016-03-28</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>

<p>We can also see that the step count for some datapoints is zero. If we look at the complete rows, we can see that on those days nearly no other data was recorded. I assume that the user probably did not wear the fitness tracker on that day and we could get rid of those complete rows.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># drop days with a step count of zero</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">'Steps'</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># plot the distribution of data for step count</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">'Steps'</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Histogram for step count'</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;matplotlib.text.Text at 0x10fb34cc0&gt;
</code></pre></div></div>

<p><img src="/images/fitbit_prophet_13_1.png" alt="png" /></p>

<p>Step count is probably the most accurate measure obtained from a pedometer. Looking at the distribution of this variable, however, we can see that there is a chance that we have outliers in the data, as at least one value seems to be much higher than all the rest.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># sort data by step count in a descending order</span>
<span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s">'Steps'</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Date</th>
      <th>Burned Calories</th>
      <th>Steps</th>
      <th>Distance</th>
      <th>Floors</th>
      <th>Sedentary Minutes</th>
      <th>Light Minutes</th>
      <th>Moderate Minutes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015-05-08</th>
      <td>1934.0</td>
      <td>905000.0</td>
      <td>0.65</td>
      <td>0.0</td>
      <td>1.355</td>
      <td>46.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2016-01-24</th>
      <td>1801.0</td>
      <td>39000.0</td>
      <td>0.03</td>
      <td>0.0</td>
      <td>1.076</td>
      <td>5.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2015-06-13</th>
      <td>4083.0</td>
      <td>26444.0</td>
      <td>19.65</td>
      <td>22.0</td>
      <td>549.000</td>
      <td>429.0</td>
      <td>56.0</td>
    </tr>
    <tr>
      <th>2016-04-28</th>
      <td>4030.0</td>
      <td>25571.0</td>
      <td>19.30</td>
      <td>15.0</td>
      <td>606.000</td>
      <td>293.0</td>
      <td>42.0</td>
    </tr>
    <tr>
      <th>2016-03-16</th>
      <td>3960.0</td>
      <td>25385.0</td>
      <td>20.45</td>
      <td>17.0</td>
      <td>638.000</td>
      <td>254.0</td>
      <td>17.0</td>
    </tr>
  </tbody>
</table>
</div>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Date</th>
      <th>Intense Minutes</th>
      <th>Intense Activity Calories</th>
      <th>Minutes Of Sleep</th>
      <th>Minutes Of Being Awake</th>
      <th>Number Of Awakings</th>
      <th>Length Of Rest In Minutes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015-05-08</th>
      <td>0.0</td>
      <td>168000.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2016-01-24</th>
      <td>0.0</td>
      <td>16000.0</td>
      <td>342.0</td>
      <td>48.0</td>
      <td>31.0</td>
      <td>390.0</td>
    </tr>
    <tr>
      <th>2015-06-13</th>
      <td>56.0</td>
      <td>2818.0</td>
      <td>169.0</td>
      <td>20.0</td>
      <td>11.0</td>
      <td>196.0</td>
    </tr>
    <tr>
      <th>2016-04-28</th>
      <td>129.0</td>
      <td>2711.0</td>
      <td>374.0</td>
      <td>56.0</td>
      <td>34.0</td>
      <td>430.0</td>
    </tr>
    <tr>
      <th>2016-03-16</th>
      <td>124.0</td>
      <td>2556.0</td>
      <td>368.0</td>
      <td>46.0</td>
      <td>22.0</td>
      <td>414.0</td>
    </tr>
  </tbody>
</table>
</div>

<p>We found the outlier! It seems that the step count for the first day (our data starts on May 8th, 2015) is too high to be a correct value for the amount of steps taken by the user on that day. Maybe the device saves the vibration since its production as step count which is loaded on the first day that the user wears the tracker. We can anyway get rid of that row since the sleep data is also not available for this day.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># drop outlier</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">'Steps'</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">100000</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>

<p>Now we can look at our preprocessed data. Shape, distribution of the variables, and a look at some rows from the dataframe, are all useful things to observe:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(369, 14)
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[</span><span class="s">'ds'</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'Date'</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s">'y'</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s">'any'</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'y'</span><span class="p">],</span> <span class="n">axlabel</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">a</span><span class="p">)</span>
    <span class="n">a</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s">'Histograms of variables from fitbit data'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.02</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/images/fitbit_prophet_20_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Date</th>
      <th>Burned Calories</th>
      <th>Steps</th>
      <th>Distance</th>
      <th>Floors</th>
      <th>Sedentary Minutes</th>
      <th>Light Minutes</th>
      <th>Moderate Minutes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015-05-09</th>
      <td>3631.0</td>
      <td>18925.0</td>
      <td>14.11</td>
      <td>4.0</td>
      <td>611.0</td>
      <td>316.0</td>
      <td>61.0</td>
    </tr>
    <tr>
      <th>2015-05-10</th>
      <td>3204.0</td>
      <td>14228.0</td>
      <td>10.57</td>
      <td>1.0</td>
      <td>602.0</td>
      <td>226.0</td>
      <td>14.0</td>
    </tr>
    <tr>
      <th>2015-05-11</th>
      <td>2673.0</td>
      <td>6756.0</td>
      <td>5.02</td>
      <td>8.0</td>
      <td>749.0</td>
      <td>190.0</td>
      <td>23.0</td>
    </tr>
    <tr>
      <th>2015-05-12</th>
      <td>2495.0</td>
      <td>5020.0</td>
      <td>3.73</td>
      <td>1.0</td>
      <td>876.0</td>
      <td>171.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2015-05-13</th>
      <td>2760.0</td>
      <td>7790.0</td>
      <td>5.79</td>
      <td>15.0</td>
      <td>726.0</td>
      <td>172.0</td>
      <td>34.0</td>
    </tr>
  </tbody>
</table>
</div>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Date</th>
      <th>Intense Minutes</th>
      <th>Intense Activity Calories</th>
      <th>Minutes Of Sleep</th>
      <th>Minutes Of Being Awake</th>
      <th>Number Of Awakings</th>
      <th>Length Of Rest In Minutes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015-05-09</th>
      <td>60.0</td>
      <td>2248.0</td>
      <td>384.0</td>
      <td>26.0</td>
      <td>23.0</td>
      <td>417.0</td>
    </tr>
    <tr>
      <th>2015-05-10</th>
      <td>77.0</td>
      <td>1719.0</td>
      <td>454.0</td>
      <td>35.0</td>
      <td>21.0</td>
      <td>491.0</td>
    </tr>
    <tr>
      <th>2015-05-11</th>
      <td>4.0</td>
      <td>962000.0</td>
      <td>387.0</td>
      <td>46.0</td>
      <td>25.0</td>
      <td>436.0</td>
    </tr>
    <tr>
      <th>2015-05-12</th>
      <td>0.0</td>
      <td>736000.0</td>
      <td>311.0</td>
      <td>31.0</td>
      <td>21.0</td>
      <td>350.0</td>
    </tr>
    <tr>
      <th>2015-05-13</th>
      <td>18.0</td>
      <td>1094.0</td>
      <td>407.0</td>
      <td>65.0</td>
      <td>44.0</td>
      <td>491.0</td>
    </tr>
  </tbody>
</table>
</div>

<h2 id="predicting-the-step-count-for-an-additional-year">Predicting the step count for an additional year</h2>

<p>In order to use the Prophet package to predict the future using a Generalized Additive Model, we need to create a dataframe with columns <code class="highlighter-rouge">ds</code> and <code class="highlighter-rouge">y</code> (we need to do this for each variable):</p>
<ul>
  <li><code class="highlighter-rouge">ds</code> is the date stamp data giving the time component</li>
  <li><code class="highlighter-rouge">y</code> is the variable that we want to predict</li>
</ul>

<p>In our case we will use the log transform of the step count in order to decrease the effect of outliers on the model.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s">'ds'</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'Date'</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s">'y'</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'Steps'</span><span class="p">]</span>
<span class="c"># log-transform of step count</span>
<span class="n">df</span><span class="p">[</span><span class="s">'y'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'y'</span><span class="p">])</span>
</code></pre></div></div>

<p>Now we need to specify the type of growth model that we want to use:</p>
<ul>
  <li>Linear: assumes that the variable <code class="highlighter-rouge">y</code> grows linearly in time (doesn’t apply to our step count scenario, if the person sticks to their normal lifestyle)</li>
  <li>Logistic: assumes that the variable <code class="highlighter-rouge">y</code> grows logistically in time and saturates at some point</li>
</ul>

<p>I will assume that the person, for whom we want to predict the step count in the following year, will not have any dramatic lifestyle changes that makes them start to walk more. Therefore, I am using logistic ‘growth’ capped to a cap of the mean of the data, which in practice means that the step count’s growth trend will be ‘zero growth’.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">[</span><span class="s">'cap'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'y'</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">Prophet</span><span class="p">(</span><span class="n">growth</span><span class="o">=</span><span class="s">'logistic'</span><span class="p">,</span> <span class="n">yearly_seasonality</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INFO:fbprophet.forecaster:Disabling daily seasonality. Run prophet with daily_seasonality=True to override this.
/Users/dario/anaconda/envs/datasci/lib/python3.6/site-packages/pystan/misc.py:399: FutureWarning: Conversion of the second argument of issubdtype from `float` to `np.floating` is deprecated. In future, it will be treated as `np.float64 == np.dtype(float).type`.
  elif np.issubdtype(np.asarray(v).dtype, float):





&lt;fbprophet.forecaster.Prophet at 0x115274dd8&gt;
</code></pre></div></div>

<p>After fitting the model, we need a new dataframe <code class="highlighter-rouge">future</code> with the additional rows for which we want to predict <code class="highlighter-rouge">y</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">future</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">make_future_dataframe</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">365</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s">'D'</span><span class="p">)</span>
<span class="n">future</span><span class="p">[</span><span class="s">'cap'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'y'</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</code></pre></div></div>

<p>Now we can call predict on the fitted model and obtain relevant statistics for the forecast period. We can also plot the results.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">forecast</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>
<span class="n">forecast</span><span class="p">[[</span><span class="s">'ds'</span><span class="p">,</span> <span class="s">'yhat'</span><span class="p">,</span> <span class="s">'yhat_lower'</span><span class="p">,</span> <span class="s">'yhat_upper'</span><span class="p">]]</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ds</th>
      <th>yhat</th>
      <th>yhat_lower</th>
      <th>yhat_upper</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>729</th>
      <td>2017-05-03</td>
      <td>9.565727</td>
      <td>9.109546</td>
      <td>10.034228</td>
    </tr>
    <tr>
      <th>730</th>
      <td>2017-05-04</td>
      <td>9.547910</td>
      <td>9.089434</td>
      <td>10.038742</td>
    </tr>
    <tr>
      <th>731</th>
      <td>2017-05-05</td>
      <td>9.536875</td>
      <td>9.084160</td>
      <td>10.035884</td>
    </tr>
    <tr>
      <th>732</th>
      <td>2017-05-06</td>
      <td>9.525034</td>
      <td>9.068735</td>
      <td>10.008784</td>
    </tr>
    <tr>
      <th>733</th>
      <td>2017-05-07</td>
      <td>9.289238</td>
      <td>8.792235</td>
      <td>9.746812</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">m</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s">'log(Steps)'</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s">'Date'</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">'1-year prediction of step count from 1 year of fitbit data'</span><span class="p">);</span>
</code></pre></div></div>

<p><img src="/images/fitbit_prophet_31_0.png" alt="png" /></p>

<p>We can see that the model did a good job in mimicking the behavior of step count during the year for which the data was available. This seems reasonable, as we do not expect the pattern to vary necessarily, if the person continues to have a similar lifestyle.</p>

<p>Additionally, we can plot the components from the Generalized Additive Model and see their effect on the ‘y’ variable. In this case we have the general trend (remember we capped this at ‘10’), the yearly seasonality effect, and the weekly effect.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">m</span><span class="o">.</span><span class="n">plot_components</span><span class="p">(</span><span class="n">forecast</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s">'GAM components for prediction of step count'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.02</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</code></pre></div></div>

<p><img src="/images/fitbit_prophet_34_0.png" alt="png" /></p>

<p>Here we see some interesting patterns:</p>
<ul>
  <li>The general ‘growth’ trend is as expected, as we assumed that there would be no growth beyond the mean of the existing data.</li>
  <li>The yearly effect shows a trend towards higher activity during the summer months, however the variation is considerable, probably due to the fact that our dataset consisted of the data for one year only</li>
  <li>The weekly effect shows that Sunday is a day of lower activity for this person whereas Saturday is the day where the activity is the highest. So, grocery shopping on Saturday, Netflix on Sunday? :)</li>
</ul>

<h2 id="sleep-analysis">Sleep analysis</h2>

<p>A very important part of our lives is sleep. It would be very interesting to look at the sleep habits of the user of the fitness tracker and see if we can get some insights from this data.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s">'ds'</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'Date'</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s">'y'</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'MinutesOfSleep'</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s">'any'</span><span class="p">)</span>
<span class="c"># drop rows where sleep time is zero, as this would mean that the person did not wear the tracker overnight and the data is missing</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'y'</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">],:]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># distribution of MinutesOfSleep</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'y'</span><span class="p">])</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x1163770f0&gt;
</code></pre></div></div>

<p><img src="/images/fitbit_prophet_39_1.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">[</span><span class="s">'cap'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'y'</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">Prophet</span><span class="p">(</span><span class="n">growth</span><span class="o">=</span><span class="s">'logistic'</span><span class="p">,</span> <span class="n">yearly_seasonality</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">future</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">make_future_dataframe</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">365</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s">'D'</span><span class="p">)</span>
<span class="n">future</span><span class="p">[</span><span class="s">'cap'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'y'</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>

<span class="n">forecast</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">forecast</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">'1-year prediction of MinutesOfSleep from 1 year of fitbit data'</span><span class="p">);</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INFO:fbprophet.forecaster:Disabling daily seasonality. Run prophet with daily_seasonality=True to override this.
/Users/dario/anaconda/envs/datasci/lib/python3.6/site-packages/pystan/misc.py:399: FutureWarning: Conversion of the second argument of issubdtype from `float` to `np.floating` is deprecated. In future, it will be treated as `np.float64 == np.dtype(float).type`.
  elif np.issubdtype(np.asarray(v).dtype, float):
</code></pre></div></div>

<p><img src="/images/fitbit_prophet_40_1.png" alt="png" /></p>

<p>The model again seems to predict a similar sleep behavior for the predicted year. This seems reasonable, as we do not expect the pattern to vary necessarily, if the person continues to have a similar lifestyle.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">m</span><span class="o">.</span><span class="n">plot_components</span><span class="p">(</span><span class="n">forecast</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s">'GAM components for prediction of MinutesOfSleep'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.02</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</code></pre></div></div>

<p><img src="/images/fitbit_prophet_42_0.png" alt="png" /></p>

<p>A look at the amount of sleep reveals:</p>
<ul>
  <li>A saturation trend at the median (we set this assumption)</li>
  <li>A yearly effect shows a trend towards higher amount of sleep during the summer months, with more variation during winter</li>
  <li>The weekly effect shows lowest sleep amount on Mondays (maybe going to bed late on Sunday and waking up early on Monday is a pattern for this user). Highest amout of sleep occurs on Saturdays (no alarm to wake up to on Saturday morning!). Interestingly, the user seems to get more sleep on Wednesdays than on Mondays or Tuesdays, which could mean that their work schedule is not constant during week-days.</li>
</ul>

<h3 id="appendix">Appendix</h3>
<p>As an exercise, I have plotted the predictions for the most interesing variables in the dataset. Enjoy!</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">zeros_allowed</span> <span class="o">=</span> <span class="p">[</span><span class="s">'Floors'</span><span class="p">,</span> <span class="s">'SedentaryMinutes'</span><span class="p">,</span> <span class="s">'LightMinutes'</span><span class="p">,</span> <span class="s">'ModerateMinutes'</span><span class="p">,</span> <span class="s">'IntenseMinutes'</span><span class="p">,</span> <span class="s">'IntenseActivityCalories'</span><span class="p">,</span> <span class="s">'MinutesOfBeingAwake'</span><span class="p">,</span> <span class="s">'NumberOfAwakings'</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">predict_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s">'Steps'</span><span class="p">,</span> <span class="s">'Floors'</span><span class="p">,</span> <span class="s">'BurnedCalories'</span><span class="p">,</span> <span class="s">'LightMinutes'</span><span class="p">,</span> <span class="s">'ModerateMinutes'</span><span class="p">,</span> <span class="s">'IntenseMinutes'</span><span class="p">,</span> <span class="s">'MinutesOfSleep'</span><span class="p">,</span> <span class="s">'MinutesOfBeingAwake'</span><span class="p">,</span> <span class="s">'NumberOfAwakings'</span><span class="p">]</span>

<span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">predict_cols</span><span class="p">,</span> <span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[</span><span class="s">'ds'</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'Date'</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s">'y'</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s">'any'</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">zeros_allowed</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'y'</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">],:]</span>

    <span class="n">df</span><span class="p">[</span><span class="s">'cap'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'y'</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">Prophet</span><span class="p">(</span><span class="n">growth</span><span class="o">=</span><span class="s">'logistic'</span><span class="p">,</span> <span class="n">yearly_seasonality</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="n">future</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">make_future_dataframe</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">365</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s">'D'</span><span class="p">)</span>
    <span class="n">future</span><span class="p">[</span><span class="s">'cap'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'y'</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
    <span class="n">future</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>

    <span class="n">forecast</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>
    <span class="n">forecast</span><span class="p">[[</span><span class="s">'ds'</span><span class="p">,</span> <span class="s">'yhat'</span><span class="p">,</span> <span class="s">'yhat_lower'</span><span class="p">,</span> <span class="s">'yhat_upper'</span><span class="p">]]</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>

    <span class="n">m</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s">''</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">a</span><span class="p">);</span>
    <span class="n">a</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

    <span class="c">#m.plot_components(forecast);</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s">'1-year prediction per variable from 1 year of fitbit data'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.02</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INFO:fbprophet.forecaster:Disabling daily seasonality. Run prophet with daily_seasonality=True to override this.
/Users/dario/anaconda/envs/datasci/lib/python3.6/site-packages/pystan/misc.py:399: FutureWarning: Conversion of the second argument of issubdtype from `float` to `np.floating` is deprecated. In future, it will be treated as `np.float64 == np.dtype(float).type`.
  elif np.issubdtype(np.asarray(v).dtype, float):
INFO:fbprophet.forecaster:Disabling daily seasonality. Run prophet with daily_seasonality=True to override this.
INFO:fbprophet.forecaster:Disabling daily seasonality. Run prophet with daily_seasonality=True to override this.
INFO:fbprophet.forecaster:Disabling daily seasonality. Run prophet with daily_seasonality=True to override this.
INFO:fbprophet.forecaster:Disabling daily seasonality. Run prophet with daily_seasonality=True to override this.
INFO:fbprophet.forecaster:Disabling daily seasonality. Run prophet with daily_seasonality=True to override this.
INFO:fbprophet.forecaster:Disabling daily seasonality. Run prophet with daily_seasonality=True to override this.
INFO:fbprophet.forecaster:Disabling daily seasonality. Run prophet with daily_seasonality=True to override this.
INFO:fbprophet.forecaster:Disabling daily seasonality. Run prophet with daily_seasonality=True to override this.
</code></pre></div></div>

<p><img src="/images/fitbit_prophet_45_1.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

  </div></div>

		</section>
	</main></body>
</html>
