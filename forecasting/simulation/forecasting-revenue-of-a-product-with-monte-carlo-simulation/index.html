<!DOCTYPE html>
<html lang="en">
<head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link href="https://fonts.googleapis.com/css?family=Merriweather:300|Raleway:400,700" rel="stylesheet">
<link rel="stylesheet" href="/assets/css/style.css">
<title>Forecasting revenue of a product with Monte-Carlo simulation</title>
<meta name="og:title" content="Philipp Schwarz"/>
<meta name="og:description" content="Machine Learning Engineer & Data Scientist  with strong statistical  modeling and programming skills. I prefer working in a high-performance environment and in an interdisciplinary team. Reach out to me if you got a project that is unprecedented, and you need a pragmatic guy that delivers."/>
<meta property="og:image" content="/assets/portfolio.png"/>
<meta property="og:url" content="/"/></head>
<body>
	<main class="container">
		<section class="about">
			<a href="/"><img src="/assets/portfolio.png" alt="Philipp Schwarz"></a>
			<h2><a href="/" style="text-decoration: none">Philipp Schwarz</a></h2>
			<p class="tagline">Data Scientist</p>
			<ul class="social"><a href="https://github.com/philippschw"><li><i class="icon-github-circled"></i></li></a><a href="https://www.linkedin.com/in/philippschw"><li><i class="icon-linkedin-squared"></i></li></a><a href="https://twitter.com/philippschw"><li><i class="icon-twitter-squared"></i></li></a></ul>
			<p>&copy; 2020</p>
		</section>
		<section class="content">
			<div class="post-container">
  <a class="post-link" href="/forecasting/simulation/forecasting-revenue-of-a-product-with-monte-carlo-simulation/">
    <h2 class="post-title">Forecasting revenue of a product with Monte-Carlo simulation</h2>
  </a>
  <div class="post-meta">
    <ul class="post-categories"><li>forecasting</li><li>simulation</li></ul>
    <div class="post-date"><i class="icon-calendar"></i>Oct 15, 2016</div>
  </div>
  <div class="post">
    <p>Being able to see the future would be a great superpower (or so one would think). Luckily, it is already possible to <em>model</em> the future using Python to gain insights into a number of problems from many different areas. In marketing, being able to model how successful a new product will be, would be of great use. In this post, I will take a look at how we can model the future revenue of a product by making certain assumptions and running a Monte Carlo Markov Chain simulation.</p>

<h2 id="what-are-monte-carlo-methods">What are Monte Carlo methods?</h2>

<p>Wikipedia tells us that:</p>
<blockquote>
  <p>Monte Carlo methods (or Monte Carlo experiments) are a broad class of computational algorithms that rely on repeated random sampling to obtain numerical results. Their essential idea is using randomness to solve problems that might be deterministic in principle.</p>
</blockquote>

<p>In simple terms, we define a number of rules about how a system will behave based on assumptions, and then use random samplings of these conditions over and over and measure the results. We can then look at the results altogether to gain insights into our model.</p>

<p>Let’s see this in practice!</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">pylab</span> <span class="kn">import</span> <span class="n">triangular</span><span class="p">,</span> <span class="n">zeros</span><span class="p">,</span> <span class="n">percentile</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">binom</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="n">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_palette</span><span class="p">(</span><span class="s">'coolwarm'</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s">"whitegrid"</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/Users/dario/anaconda/envs/tensorflow/lib/python3.5/site-packages/matplotlib/font_manager.py:273: UserWarning: Matplotlib is building the font cache using fc-list. This may take a moment.
  warnings.warn('Matplotlib is building the font cache using fc-list. This may take a moment.')
/Users/dario/anaconda/envs/tensorflow/lib/python3.5/site-packages/matplotlib/font_manager.py:273: UserWarning: Matplotlib is building the font cache using fc-list. This may take a moment.
  warnings.warn('Matplotlib is building the font cache using fc-list. This may take a moment.')
</code></pre></div></div>

<h2 id="define-the-initial-assumptions">Define the initial assumptions</h2>

<p>What assumptions can we safely make regarding our new product? For example, what is the estimated market size that we want to work with and what is the estimated price that we can expect. We also define the num_timesteps, the number of years for which we want to make the calculations.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># initial market size assumption (total number of potential users)</span>
<span class="n">marketsize_min</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">marketsize_mode</span> <span class="o">=</span> <span class="mi">12000</span>
<span class="n">marketsize_max</span> <span class="o">=</span> <span class="mi">15000</span>

<span class="n">marketshare_init</span> <span class="o">=</span> <span class="n">triangular</span><span class="p">(</span><span class="o">.</span><span class="mo">003</span><span class="p">,</span> <span class="o">.</span><span class="mo">005</span><span class="p">,</span> <span class="o">.</span><span class="mo">01</span><span class="p">)</span> <span class="c"># min, mode, max</span>
<span class="c"># initial percentage of users that use the product</span>

<span class="n">price_min</span><span class="o">=</span><span class="mi">500</span> <span class="c"># minimum product price</span>
<span class="n">price_mode</span><span class="o">=</span><span class="mi">1000</span> <span class="c"># mode product price</span>
<span class="n">price_max</span><span class="o">=</span><span class="mi">1500</span> <span class="c"># maximum product price</span>

<span class="n">num_timesteps</span><span class="o">=</span><span class="mi">10</span> <span class="c"># number of years for the simulation</span>
<span class="n">num_simulations</span><span class="o">=</span><span class="mi">1024</span> <span class="c"># number of simulations per year</span>
<span class="n">perc_selection</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">95</span><span class="p">]</span> <span class="c"># percentiles to visualize in plots</span>
</code></pre></div></div>

<h2 id="define-the-functions-to-calculate-market-share-and-revenue-of-a-product">Define the functions to calculate market share and revenue of a product</h2>

<p>These are the functions used to get the data points by random sampling. Each time we run each function, the variables are randomly defined from a range and a result is obtained, e.g. a market share or a revenue amount.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">calc_marketshare</span><span class="p">(</span><span class="n">marketsize</span><span class="p">,</span> <span class="n">marketshare</span><span class="p">):</span>
    <span class="s">'''
    Calculates product market share for a given year as percentage of users
    that use the product compared to total number of users
    
    Arguments:
    marketsize : total market size as number of potential users
    marketshare: observed/assumed percentage of users that use the product
    '''</span>    
    <span class="n">share</span> <span class="o">=</span> <span class="n">binom</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">marketsize</span><span class="p">,</span> <span class="n">marketshare</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">marketsize</span>    
    <span class="k">return</span> <span class="n">share</span>


<span class="k">def</span> <span class="nf">calc_revenue</span><span class="p">(</span><span class="n">marketsize</span><span class="p">,</span> <span class="n">marketshare</span><span class="p">):</span>
    <span class="s">'''
    Calculates the revenue development over a number of years
    
    Arguments:
    marketsize: total market size as number of potential users
    marketshare : observed/assumed percentarge of users that use the product
    '''</span>    
    <span class="n">product_price</span> <span class="o">=</span> <span class="n">triangular</span><span class="p">(</span><span class="n">price_min</span><span class="p">,</span> <span class="n">price_mode</span><span class="p">,</span> <span class="n">price_max</span><span class="p">)</span>
    <span class="n">volume</span> <span class="o">=</span> <span class="n">marketsize</span><span class="o">*</span><span class="n">marketshare</span>
    <span class="n">revenue</span> <span class="o">=</span> <span class="n">product_price</span> <span class="o">*</span> <span class="n">volume</span>
    <span class="k">return</span> <span class="n">revenue</span>
</code></pre></div></div>

<p>Additionally, in case that a distribution is not included in the standard statistical modules of Python, we can custom write them. For example, we can define functions to return logistic and sigmoid distributions.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">logist</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">factor</span><span class="p">):</span>
    <span class="s">'''
    Logistic distribution
    Args:
    x : variable in x-axis, e.g. time
    loc : the mean of the distribution, maximum probability
    scale : steepness of the curve, higher -&gt; steeper
    factor : multiplies to obtain higher probabilities overall
    '''</span>
    <span class="k">return</span> <span class="n">factor</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">loc</span><span class="o">-</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">scale</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">scale</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">loc</span><span class="o">-</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">scale</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">L</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">loc</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span>
    <span class="k">return</span> <span class="n">L</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">loc</span><span class="p">)))</span>
</code></pre></div></div>

<p>Why do we need this logistic distribution? For example, if we want to take into account the market growth in the next ten years, we could simply assume it will be 1% or 2% or 10% and keep it constant. However, we have Python on our side and can rather model this growth in a semi-random way. We assume that the market growth is more likely to be lower (between 0 and 4%) but we want to also consider the lower probability cases in which the growth could be higher, e.g. 8%.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">logist_test</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">loc</span><span class="o">-</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">scale</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">scale</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">loc</span><span class="o">-</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">scale</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">logist_test</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="c">#plt.plot(bins, logist(bins, loc, scale)*count.max()/logist(bins, loc, scale).max())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/images/product-revenue-forecast_11_0.png" alt="png" /></p>

<h2 id="data-collection-and-simulation">Data collection and simulation</h2>

<p>Now that we have all assumptions and “rules” in place, let’s get some data points.</p>

<p>First let’s create some empty matrixes where we will put the data later.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">u</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">num_simulations</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> 
<span class="c"># temporary market size matrix as number of potential users</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">num_simulations</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="c"># temporary market share matrix</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">num_simulations</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="c"># temporary revenue matrix</span>

<span class="n">rev</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">num_timesteps</span><span class="p">,</span> <span class="n">num_simulations</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> 
<span class="c"># revenue data collection by year</span>
<span class="n">percentiles_rev</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">num_timesteps</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">perc_selection</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> 
<span class="c"># percentiles_rev data collection by year</span>

<span class="n">usr</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">num_timesteps</span><span class="p">,</span> <span class="n">num_simulations</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> 
<span class="c"># users data collection by year</span>
<span class="n">percentiles_usr</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">num_timesteps</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">perc_selection</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> 
<span class="c"># percentiles for total users</span>

<span class="n">sha</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">num_timesteps</span><span class="p">,</span> <span class="n">num_simulations</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> 
<span class="c"># market share data collection by year</span>
<span class="n">percentiles_sha</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">num_timesteps</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">perc_selection</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> 
<span class="c"># percentiles for market share</span>
</code></pre></div></div>

<p>Now we can run the simulations to get our data points for the next 10 years. The results are captured in the pre-created matrices.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_timesteps</span><span class="p">):</span>
    
    <span class="k">if</span> <span class="n">t</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="c"># First year starting with initial assumptions</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_simulations</span><span class="p">):</span>
            <span class="n">u</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">triangular</span><span class="p">(</span><span class="n">marketsize_min</span><span class="p">,</span><span class="n">marketsize_mode</span><span class="p">,</span><span class="n">marketsize_max</span><span class="p">)</span> 
            <span class="c"># triangular distribution of current number of potential users</span>
            <span class="n">s</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">calc_marketshare</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">marketshare_init</span><span class="p">)</span> 
            <span class="c"># market share for product</span>
            <span class="n">r</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">calc_revenue</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="c"># revenue</span>
        <span class="c"># store values in first row of matrices:</span>
        <span class="n">rev</span><span class="p">[</span><span class="n">t</span><span class="p">,:]</span> <span class="o">+=</span> <span class="n">r</span>
        <span class="n">usr</span><span class="p">[</span><span class="n">t</span><span class="p">,:]</span> <span class="o">+=</span> <span class="n">u</span>
        <span class="n">sha</span><span class="p">[</span><span class="n">t</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">s</span>
        <span class="c">#percentiles of the complete revenue row at time t        </span>
        <span class="n">percentiles_rev</span><span class="p">[</span><span class="n">t</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">percentile</span><span class="p">(</span><span class="n">rev</span><span class="p">[</span><span class="n">t</span><span class="p">,:],</span> <span class="n">perc_selection</span><span class="p">)</span>
        <span class="n">percentiles_usr</span><span class="p">[</span><span class="n">t</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">percentile</span><span class="p">(</span><span class="n">usr</span><span class="p">[</span><span class="n">t</span><span class="p">,:],</span> <span class="n">perc_selection</span><span class="p">)</span>
        <span class="n">percentiles_sha</span><span class="p">[</span><span class="n">t</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">percentile</span><span class="p">(</span><span class="n">sha</span><span class="p">[</span><span class="n">t</span><span class="p">,:],</span> <span class="n">perc_selection</span><span class="p">)</span>
        
    <span class="k">else</span><span class="p">:</span> <span class="c"># Following years starting with the previous year's data</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_simulations</span><span class="p">):</span>
            <span class="c"># estimate how much the market has grown:</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">triangular</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">triangular</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="n">marketgrowth</span> <span class="o">=</span> <span class="n">logist</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">factor</span><span class="p">)</span>
            <span class="n">u</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">u</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">marketgrowth</span> <span class="c"># apply market growth</span>
            <span class="n">s</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">calc_marketshare</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">+</span> <span class="n">logist</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> 
            <span class="c"># apply market share increase</span>
            <span class="n">r</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">calc_revenue</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="c"># calculate revenue</span>
        <span class="c"># store values in following rows of matrices</span>
        <span class="n">rev</span><span class="p">[</span><span class="n">t</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">rev</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">+</span> <span class="n">r</span>
        <span class="n">usr</span><span class="p">[</span><span class="n">t</span><span class="p">,:]</span> <span class="o">+=</span> <span class="n">u</span>
        <span class="n">sha</span><span class="p">[</span><span class="n">t</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">s</span>
        <span class="c">#percentiles of the complete revenue row at time t</span>
        <span class="n">percentiles_rev</span><span class="p">[</span><span class="n">t</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">percentile</span><span class="p">(</span><span class="n">rev</span><span class="p">[</span><span class="n">t</span><span class="p">,:],</span> <span class="n">perc_selection</span><span class="p">)</span>
        <span class="n">percentiles_usr</span><span class="p">[</span><span class="n">t</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">percentile</span><span class="p">(</span><span class="n">usr</span><span class="p">[</span><span class="n">t</span><span class="p">,:],</span> <span class="n">perc_selection</span><span class="p">)</span>
        <span class="n">percentiles_sha</span><span class="p">[</span><span class="n">t</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">percentile</span><span class="p">(</span><span class="n">sha</span><span class="p">[</span><span class="n">t</span><span class="p">,:],</span> <span class="n">perc_selection</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="revenue-simulation-plots">Revenue simulation plots</h2>

<p>Having captured all our data, we can now plot it to see how the variable of interest, in this case the revenue of the new product, develops in the next 10 years.</p>

<p>First we print the percentiles to get the numeric data:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Print the percentiles of revenue</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">percentiles_rev</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'5</span><span class="si">%</span><span class="s">'</span><span class="p">,</span><span class="s">'25</span><span class="si">%</span><span class="s">'</span><span class="p">,</span><span class="s">'50</span><span class="si">%</span><span class="s">'</span><span class="p">,</span><span class="s">'75</span><span class="si">%</span><span class="s">'</span><span class="p">,</span><span class="s">'95</span><span class="si">%</span><span class="s">'</span><span class="p">])</span>
<span class="n">df</span>
</code></pre></div></div>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>5%</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>95%</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4.409820e+04</td>
      <td>6.105972e+04</td>
      <td>7.709451e+04</td>
      <td>9.426475e+04</td>
      <td>1.180631e+05</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4.908791e+05</td>
      <td>6.756409e+05</td>
      <td>8.264907e+05</td>
      <td>9.994591e+05</td>
      <td>1.235754e+06</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.675192e+06</td>
      <td>2.313494e+06</td>
      <td>2.817660e+06</td>
      <td>3.264348e+06</td>
      <td>4.048545e+06</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4.206653e+06</td>
      <td>5.635622e+06</td>
      <td>6.838129e+06</td>
      <td>8.115342e+06</td>
      <td>9.764499e+06</td>
    </tr>
    <tr>
      <th>4</th>
      <td>8.549564e+06</td>
      <td>1.154145e+07</td>
      <td>1.378219e+07</td>
      <td>1.624323e+07</td>
      <td>2.006074e+07</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1.549143e+07</td>
      <td>2.064907e+07</td>
      <td>2.464899e+07</td>
      <td>2.935327e+07</td>
      <td>3.529438e+07</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2.529986e+07</td>
      <td>3.358534e+07</td>
      <td>3.994820e+07</td>
      <td>4.737894e+07</td>
      <td>5.784066e+07</td>
    </tr>
    <tr>
      <th>7</th>
      <td>3.803804e+07</td>
      <td>5.056080e+07</td>
      <td>5.988783e+07</td>
      <td>7.052721e+07</td>
      <td>8.471665e+07</td>
    </tr>
    <tr>
      <th>8</th>
      <td>5.257025e+07</td>
      <td>7.126223e+07</td>
      <td>8.484492e+07</td>
      <td>9.885473e+07</td>
      <td>1.187698e+08</td>
    </tr>
    <tr>
      <th>9</th>
      <td>6.901057e+07</td>
      <td>9.476733e+07</td>
      <td>1.119965e+08</td>
      <td>1.314466e+08</td>
      <td>1.580819e+08</td>
    </tr>
  </tbody>
</table>
</div>

<p>Now we can plot these percentiles of revenue in an aggregated form.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Plot the percentiles of revenue</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s">'line'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'black'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">df</span><span class="p">[</span><span class="s">'25</span><span class="si">%</span><span class="s">'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">df</span><span class="p">[</span><span class="s">'75</span><span class="si">%</span><span class="s">'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'grey'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">df</span><span class="p">[</span><span class="s">'5</span><span class="si">%</span><span class="s">'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">df</span><span class="p">[</span><span class="s">'95</span><span class="si">%</span><span class="s">'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'grey'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">"Revenue percentiles over </span><span class="si">%</span><span class="s">s years"</span> <span class="o">%</span><span class="n">num_timesteps</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/images/product-revenue-forecast_19_0.png" alt="png" /></p>

<p>We can also plot the individual “random walks” of the simulation just for fun.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Plot the random walks for revenue</span>
<span class="n">df2</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rev</span><span class="p">)</span>
<span class="n">df2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s">'line'</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mo">03</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">"Revenue random walks over </span><span class="si">%</span><span class="s">s years"</span> <span class="o">%</span><span class="n">num_timesteps</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/images/product-revenue-forecast_21_0.png" alt="png" /></p>

<h2 id="market-share-simulation-plots">Market share simulation plots</h2>

<p>Similarly, let’s plot our simulation results for the market share calculations</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Print the percentiles of market size</span>
<span class="n">df_usr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">percentiles_usr</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'5</span><span class="si">%</span><span class="s">'</span><span class="p">,</span><span class="s">'25</span><span class="si">%</span><span class="s">'</span><span class="p">,</span><span class="s">'50</span><span class="si">%</span><span class="s">'</span><span class="p">,</span><span class="s">'75</span><span class="si">%</span><span class="s">'</span><span class="p">,</span><span class="s">'95</span><span class="si">%</span><span class="s">'</span><span class="p">])</span>
<span class="c">#print(df)</span>

<span class="c"># Plot the percentiles market size</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">df_usr</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s">'line'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'w'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">df_usr</span><span class="p">[</span><span class="s">'25</span><span class="si">%</span><span class="s">'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">df_usr</span><span class="p">[</span><span class="s">'75</span><span class="si">%</span><span class="s">'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'grey'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">df_usr</span><span class="p">[</span><span class="s">'5</span><span class="si">%</span><span class="s">'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">df_usr</span><span class="p">[</span><span class="s">'95</span><span class="si">%</span><span class="s">'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'grey'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">"Market size percentiles over </span><span class="si">%</span><span class="s">s years"</span> <span class="o">%</span><span class="n">num_timesteps</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/images/product-revenue-forecast_23_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Plot the random walks for market size</span>
<span class="n">df2</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">usr</span><span class="p">)</span>
<span class="n">df2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s">'line'</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mo">03</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">"Market size random walks over </span><span class="si">%</span><span class="s">s years"</span> <span class="o">%</span><span class="n">num_timesteps</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/images/product-revenue-forecast_24_0.png" alt="png" /></p>

<h2 id="product-revenue-and-market-size-distribution">Product revenue and market size distribution</h2>

<p>Finally, we can visualize how the revenue is distributed in our simulation for a particular year using histograms. For example, let’s plot the distribution of revenue:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">"Product revenue, price mode </span><span class="si">%</span><span class="s">s €"</span> <span class="o">%</span><span class="n">price_mode</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">rev</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="nb">max</span><span class="p">()),</span> <span class="n">label</span><span class="o">=</span><span class="s">'year 1'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">rev</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="nb">max</span><span class="p">()),</span> <span class="n">label</span><span class="o">=</span><span class="s">'year 3'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">rev</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="nb">max</span><span class="p">()),</span> <span class="n">label</span><span class="o">=</span><span class="s">'year 5'</span><span class="p">)</span><span class="c">#axis([0,width,0,height])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">rev</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="nb">max</span><span class="p">()),</span> <span class="n">label</span><span class="o">=</span><span class="s">'year 7'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/images/product-revenue-forecast_26_0.png" alt="png" /></p>

<p>Of course, the farther in the future our model, the wider the distribution, as our model gets more and more uncertain.</p>

<p>We can do the same with the market size distribution:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax2</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">"Market size, price mode </span><span class="si">%</span><span class="s">s €"</span> <span class="o">%</span><span class="n">price_mode</span><span class="p">)</span>
<span class="c">#hist(c, bins=50, range=(0, c.max()), )</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">usr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="nb">max</span><span class="p">()),</span> <span class="n">label</span><span class="o">=</span><span class="s">'year 1'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">usr</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="nb">max</span><span class="p">()),</span> <span class="n">label</span><span class="o">=</span><span class="s">'year 3'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">usr</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="nb">max</span><span class="p">()),</span> <span class="n">label</span><span class="o">=</span><span class="s">'year 5'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">usr</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="nb">max</span><span class="p">()),</span> <span class="n">label</span><span class="o">=</span><span class="s">'year 7'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/images/product-revenue-forecast_28_0.png" alt="png" /></p>

<h1 id="final-remarks">Final remarks</h1>

<p>In this post, we saw how we can use Python to model a simple Monte Carlo simulation and how we can plot these results to look at forecasting from a different perspective.</p>

  </div></div>

		</section>
	</main></body>
</html>
