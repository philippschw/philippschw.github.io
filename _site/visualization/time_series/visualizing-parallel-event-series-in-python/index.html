<!DOCTYPE html>
<html lang="en">
<head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link href="https://fonts.googleapis.com/css?family=Merriweather:300|Raleway:400,700" rel="stylesheet">
<link rel="stylesheet" href="/assets/css/style.css">
<title>Visualizing parallel event series in Python</title>
<meta name="og:title" content="Philipp Schwarz"/>
<meta name="og:description" content="Machine Learning Engineer & Data Scientist  with strong statistical  modeling and programming skills. I prefer working in a high-performance environment and in an interdisciplinary team. Reach out to me if you got a project that is unprecedented, and you need a pragmatic guy that delivers."/>
<meta property="og:image" content="/assets/portfolio.png"/>
<meta property="og:url" content="/"/></head>
<body>
	<main class="container">
		<section class="about">
			<a href="/"><img src="/assets/portfolio.png" alt="Philipp Schwarz"></a>
			<h2><a href="/" style="text-decoration: none">Philipp Schwarz</a></h2>
			<p class="tagline">Data Scientist</p>
			<ul class="social"><a href="https://github.com/philippschw"><li><i class="icon-github-circled"></i></li></a><a href="https://www.linkedin.com/in/philippschw"><li><i class="icon-linkedin-squared"></i></li></a><a href="https://twitter.com/philippschw"><li><i class="icon-twitter-squared"></i></li></a></ul>
			<p>&copy; 2020</p>
		</section>
		<section class="content">
			<div class="post-container">
  <a class="post-link" href="/visualization/time_series/visualizing-parallel-event-series-in-python/">
    <h2 class="post-title">Visualizing parallel event series in Python</h2>
  </a>
  <div class="post-meta">
    <ul class="post-categories"><li>visualization</li><li>time_series</li></ul>
    <div class="post-date"><i class="icon-calendar"></i>Dec 16, 2016</div>
  </div>
  <div class="post">
    <p>Do movie releases produce literal earthquakes? We always hear about new movie releases being a “blast”, some sure are. But how do two independent events correlate with each other? In this post, I will use Python to visualize two different series of events, plotting them on top of each other to gain insights from time series data.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Imports</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="n">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_palette</span><span class="p">(</span><span class="s">'Set2'</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s">"whitegrid"</span><span class="p">)</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</code></pre></div></div>

<h1 id="getting-the-data">Getting the data</h1>

<p>To make this example more fun, I decided to use two independent series of events for which data is readily available in the internet:</p>

<ul>
  <li><a href="http://world-earthquakes.com/index.php?option=eqs&amp;year=2016">List of earthquakes around the world</a></li>
  <li><a href="http://www.firstshowing.net/schedule2016/">List of film releases in the USA</a></li>
</ul>

<h2 id="clean-and-prepare-earthquake-data">Clean and prepare earthquake data</h2>

<p>We start by downloading the .csv export from the <a href="http://world-earthquakes.com/index.php?option=eqs&amp;year=2016">world earthquake website</a> to the ‘data’ directory and reading the file into a pandas DataFrame</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'data/earthquakes_raw.csv'</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">';'</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">how</span><span class="o">=</span><span class="s">'all'</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Zone/Region</th>
      <th>Magnitude (Mw)</th>
      <th>Year</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>December 09</td>
      <td>SOLOMON ISLANDS</td>
      <td>6.9</td>
      <td>2016</td>
    </tr>
    <tr>
      <th>1</th>
      <td>December 08</td>
      <td>CALIFORNIA</td>
      <td>6.5</td>
      <td>2016</td>
    </tr>
    <tr>
      <th>2</th>
      <td>December 08</td>
      <td>SOLOMON ISLANDS</td>
      <td>7.8</td>
      <td>2016</td>
    </tr>
    <tr>
      <th>3</th>
      <td>December 06</td>
      <td>SUMATRA</td>
      <td>6.5</td>
      <td>2016</td>
    </tr>
    <tr>
      <th>4</th>
      <td>November 25</td>
      <td>CHINA</td>
      <td>6.6</td>
      <td>2016</td>
    </tr>
  </tbody>
</table>
</div>

<p>We have to unify the date information from the Date and Year columns. Then we can save the cleaned-up earthquake date data to a file ‘data/earthquakes.csv’</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">[</span><span class="s">'Date'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'Date'</span><span class="p">]</span> <span class="o">+</span> <span class="s">' '</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s">'Year'</span><span class="p">]</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="k">del</span> <span class="n">df</span><span class="p">[</span><span class="s">'Year'</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s">'Date'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'Date'</span><span class="p">]</span><span class="o">.</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> 
                              <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s">'</span><span class="si">%</span><span class="s">B </span><span class="si">%</span><span class="s">d </span><span class="si">%</span><span class="s">Y'</span><span class="p">))</span>
<span class="n">df</span><span class="p">[</span><span class="s">'Date'</span><span class="p">]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s">'data/earthquakes.csv'</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Zone/Region</th>
      <th>Magnitude (Mw)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2016-12-09</td>
      <td>SOLOMON ISLANDS</td>
      <td>6.9</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2016-12-08</td>
      <td>CALIFORNIA</td>
      <td>6.5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2016-12-08</td>
      <td>SOLOMON ISLANDS</td>
      <td>7.8</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2016-12-06</td>
      <td>SUMATRA</td>
      <td>6.5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2016-11-25</td>
      <td>CHINA</td>
      <td>6.6</td>
    </tr>
  </tbody>
</table>
</div>

<h2 id="clean-and-prepare-movie-release-data">Clean and prepare movie release data</h2>

<p>The movie release data was retrieved from <a href="http://www.firstshowing.net/schedule2016/">this website</a> and saved to the ‘data’ directory. We then read the file into a pandas DataFrame. The resulting table tells us the release date and which movies where released on a that date (up to 5 movies).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'data/filmrelease_raw.csv'</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">';'</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">how</span><span class="o">=</span><span class="s">'all'</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s">'Date'</span><span class="p">,</span> <span class="s">'Film1'</span><span class="p">,</span> <span class="s">'Film2'</span><span class="p">,</span> <span class="s">'Film3'</span><span class="p">,</span> <span class="s">'Film4'</span><span class="p">,</span> <span class="s">'Film5'</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(),</span> <span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(                        Date              Film1            Film2  \
 0    Friday, January 9, 2015            Taken 3              NaN   
 4   Friday, January 16, 2015           Blackhat       Paddington   
 14  Friday, January 23, 2015          Mortdecai    Strange Magic   
 24  Friday, January 30, 2015     Black or White  Project Almanac   
 34  Friday, February 6, 2015  Jupiter Ascending      Seventh Son   
 
                                    Film3 Film4 Film5  
 0                                    NaN   NaN   NaN  
 4                     The Wedding Ringer   NaN   NaN  
 14                     The Boy Next Door   NaN   NaN  
 24                              The Loft   NaN   NaN  
 34  SpongeBob Movie: Sponge Out of Water   NaN   NaN  ,
                        Date                     Film1         Film2  \
 836      Friday, December 9  🎥 Office Christmas Party           NaN   
 840     Friday, December 16       🎥 Collateral Beauty  🎥 La La Land   
 850  Wednesday, December 21        🎥 Assassin's Creed  🎥 Passengers   
 863     Friday, December 23                🎥 Why Him?           NaN   
 867     Sunday, December 25                  🎥 Fences           NaN   
 
                               Film3   Film4 Film5  
 836                             NaN     NaN   NaN  
 840  🎥 Rogue One: A Star Wars Story     NaN   NaN  
 850                  🎥 Patriots Day  🎥 Sing   NaN  
 863                             NaN     NaN   NaN  
 867                             NaN     NaN   NaN  )
</code></pre></div></div>

<p>Talk about raw <em>unclean</em> data! It seems that, at the top of the table, the date information contains the year (2015). However, upon further inspection we can see that the bottom of the table does not show us the year anymore. From the website information we find out that, after the index 716 and onwards, the missing year information is ‘2016’. So we add this data to the DataFrame and change the date format to a more readable one.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="mi">716</span><span class="p">,</span> <span class="s">'Date'</span><span class="p">]</span> <span class="o">+=</span> <span class="s">', 2016'</span>
<span class="n">df</span><span class="p">[</span><span class="s">'Date'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'Date'</span><span class="p">]</span><span class="o">.</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> 
                              <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s">'</span><span class="si">%</span><span class="s">A, </span><span class="si">%</span><span class="s">B </span><span class="si">%</span><span class="s">d, </span><span class="si">%</span><span class="s">Y'</span><span class="p">))</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Film1</th>
      <th>Film2</th>
      <th>Film3</th>
      <th>Film4</th>
      <th>Film5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015-01-09</td>
      <td>Taken 3</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2015-01-16</td>
      <td>Blackhat</td>
      <td>Paddington</td>
      <td>The Wedding Ringer</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>14</th>
      <td>2015-01-23</td>
      <td>Mortdecai</td>
      <td>Strange Magic</td>
      <td>The Boy Next Door</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>24</th>
      <td>2015-01-30</td>
      <td>Black or White</td>
      <td>Project Almanac</td>
      <td>The Loft</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>34</th>
      <td>2015-02-06</td>
      <td>Jupiter Ascending</td>
      <td>Seventh Son</td>
      <td>SpongeBob Movie: Sponge Out of Water</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>

<p>For the purpose of plotting the frequency of an event, we are not interested in what movies were released, but only in how many on a particular date. We can count the movies by replacing the names with ones and calculating the sum.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># replace movie names with ones</span>
<span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">r'\w'</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Film1</th>
      <th>Film2</th>
      <th>Film3</th>
      <th>Film4</th>
      <th>Film5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015-01-09</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2015-01-16</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>14</th>
      <td>2015-01-23</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>24</th>
      <td>2015-01-30</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>34</th>
      <td>2015-02-06</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>

<p>We can finally get rid of the unnecessary columns and save the clean data to a file. Now we are ready to start plotting our event series data.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">[</span><span class="s">'film_sum'</span><span class="p">]</span> <span class="o">=</span><span class="n">df</span><span class="p">[[</span><span class="s">'Film1'</span><span class="p">,</span> <span class="s">'Film2'</span><span class="p">,</span> <span class="s">'Film3'</span><span class="p">,</span> <span class="s">'Film4'</span><span class="p">,</span> <span class="s">'Film5'</span><span class="p">]]</span><span class="o">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s">'Film1'</span><span class="p">,</span> <span class="s">'Film2'</span><span class="p">,</span> <span class="s">'Film3'</span><span class="p">,</span> <span class="s">'Film4'</span><span class="p">,</span> <span class="s">'Film5'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s">'data/filmrelease.csv'</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>film_sum</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015-01-09</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2015-01-16</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>2015-01-23</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>24</th>
      <td>2015-01-30</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>34</th>
      <td>2015-02-06</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div>

<h2 id="load-the-data-to-the-plotting-variables">Load the data to the plotting variables</h2>

<p>To use this script, we have to load the clean data that we saved in the previuos steps.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Load the earthquake data and add a column with ones since there was only one earthquake per row</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'data/earthquakes.csv'</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<span class="k">del</span> <span class="n">df1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">df1</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s">'Date'</span><span class="p">]</span>
<span class="n">df1</span><span class="p">[</span><span class="s">'earthquake'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df1</span><span class="p">))</span>
<span class="n">df1</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>earthquake</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2016-12-09</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2016-12-08</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2016-12-08</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2016-12-06</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2016-11-25</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Load the movie data, the second column already shows us the sum of movie releases</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'data/filmrelease.csv'</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="k">del</span> <span class="n">df2</span><span class="p">[</span><span class="s">'Unnamed: 0'</span><span class="p">]</span>
<span class="n">df2</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s">'Date'</span><span class="p">,</span> <span class="s">'movie_release'</span><span class="p">]</span>
<span class="n">df2</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>movie_release</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015-01-09</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2015-01-16</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2015-01-23</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2015-01-30</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2015-02-06</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div>

<p>As end result, we want to have a single DataFrame containing the data for both event series. Moreover, we want to have a continuous time series, including those days in which none of the two events took place (no earthquakes, and no movie releases). We do this by using the concatenate and resample functions of pandas.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Concatenate both DataFrames into one</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Date</span><span class="p">))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s">'1d'</span><span class="p">)</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c"># to complete every day</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div></div>

<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>earthquake</th>
      <th>movie_release</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015-01-09</th>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2015-01-10</th>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2015-01-11</th>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2015-01-12</th>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2015-01-13</th>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2015-01-14</th>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2015-01-15</th>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2015-01-16</th>
      <td>0.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>2015-01-17</th>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2015-01-18</th>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>

<h1 id="calculating-and-plotting-a-moving-average">Calculating and plotting a moving average</h1>

<p>We could simply plot each event occurrence as a data point in a time series. However, this will likely yield a graph that is not very informative. Much easier to grasp is a moving average that tells us the average frequency of the events for a defined period of time in the past. We can create columns for these moving averages, which we can then easily plot.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Calculate moving average</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">7</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="mi">2</span><span class="p">]:</span>
    <span class="n">mvav</span> <span class="o">=</span> <span class="n">i</span> <span class="c"># moving average period, i.e. number of points to average</span>
    <span class="n">dfi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'earthquake'</span><span class="p">],</span> 
                      <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">mvav</span><span class="p">,))</span><span class="o">*</span><span class="mi">7</span><span class="o">/</span><span class="n">mvav</span> <span class="c"># factor for obtaining average</span>
                      <span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">'full'</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s">'earthquake moving average </span><span class="si">%</span><span class="s">sw'</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">7</span><span class="p">))]</span> <span class="o">=</span> <span class="n">dfi</span><span class="p">[:</span><span class="o">-</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
    <span class="n">dfj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'movie_release'</span><span class="p">],</span> 
                      <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">mvav</span><span class="p">,))</span><span class="o">*</span><span class="mi">7</span><span class="o">/</span><span class="n">mvav</span> <span class="c"># factor for obtaining average</span>
                      <span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">'full'</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s">'movie_release moving average </span><span class="si">%</span><span class="s">sw'</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">7</span><span class="p">))]</span> <span class="o">=</span> <span class="n">dfj</span><span class="p">[:</span><span class="o">-</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>earthquake</th>
      <th>movie_release</th>
      <th>earthquake moving average 4w</th>
      <th>movie_release moving average 4w</th>
      <th>earthquake moving average 8w</th>
      <th>movie_release moving average 8w</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015-01-09</th>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.25</td>
      <td>0.0</td>
      <td>0.125</td>
    </tr>
    <tr>
      <th>2015-01-10</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.25</td>
      <td>0.0</td>
      <td>0.125</td>
    </tr>
    <tr>
      <th>2015-01-11</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.25</td>
      <td>0.0</td>
      <td>0.125</td>
    </tr>
    <tr>
      <th>2015-01-12</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.25</td>
      <td>0.0</td>
      <td>0.125</td>
    </tr>
    <tr>
      <th>2015-01-13</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.25</td>
      <td>0.0</td>
      <td>0.125</td>
    </tr>
  </tbody>
</table>
</div>

<p>The shorter the period that we choose for the moving average, the noisier our graphic will get. Let’s settle with a moving average that reflects the frequency during the past 8 weeks. And <em>voilà</em>! Now we can see how the frequency of earthquakes and movie releases changed over time.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Plot relevant columns from dataframe</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s">'earthquake moving average 8w'</span><span class="p">,</span> <span class="s">'movie_release moving average 8w'</span><span class="p">]]</span><span class="o">.</span>\
<span class="n">plot</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s">'Set2'</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span><span class="c"># possible</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="nb">max</span><span class="p">()</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Moving average of events per week'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'Frequency'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/images/event-tracker_29_0.png" alt="png" /></p>

<h1 id="descriptive-analysis-of-the-event-occurrence">Descriptive analysis of the event occurrence</h1>

<p>What other insights can we get from this data set? Two very dissimilar series of events, one natural, and one man-made, will surely have very different properties. Let’s start with a simple question: on which days of the week do both events typically happen?</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#%% DAY OF THE WEEK ANALYSIS</span>

<span class="c"># create column for day of the week</span>
<span class="n">df</span><span class="p">[</span><span class="s">'Day'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">dayofweek</span>
<span class="n">df</span><span class="p">[</span><span class="s">'Day'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">Day</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">'category'</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">Day</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span> <span class="o">=</span> <span class="p">[</span><span class="s">'Mon'</span><span class="p">,</span><span class="s">'Tue'</span><span class="p">,</span> <span class="s">'Wed'</span><span class="p">,</span> <span class="s">'Thu'</span><span class="p">,</span> <span class="s">'Fri'</span><span class="p">,</span> <span class="s">'Sat'</span><span class="p">,</span> <span class="s">'Sun'</span><span class="p">]</span>

<span class="c"># create column for type</span>
<span class="n">df</span><span class="p">[</span><span class="s">'Type'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'earthquake'</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span> <span class="s">'earthquake'</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'movie_release'</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span>\
 <span class="s">'movie_release'</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">))</span>
<span class="n">df</span><span class="p">[</span><span class="s">'Type'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'Type'</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">'category'</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s">'Type'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'Type'</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">remove_categories</span><span class="p">([</span><span class="s">'nan'</span><span class="p">])</span>

<span class="c"># show count for each day</span>
<span class="c">#df[(df.Event1 == 1)&amp;(df.Day == 'Mon')].Day.count()</span>

<span class="c"># plot count data per day of the week</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Event count per day of the week'</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s">'Day'</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s">'Type'</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/images/event-tracker_32_0.png" alt="png" /></p>

<p>We can see that nature does not respect our weekends, as earthquakes seem to be flatly distributed by day of the week.</p>

<p>The movie releases, on the other hand, are most frequent on Friday, followed by Wednesday and a few on Sunday (it’s almost as if movie release days were <em>chosen</em> by someone… /s). It seems that, if you’re planning to release a new movie in the US, Friday is the way to go. People are usually happy to start the weekend with a leisurely activity, so that makes sense. As of why Saturdays and Sundays are almost not used as movie release days, even though on this days people are also usually free from work, it would be interesting to find out why. Another intriguing finding is the not high but remarkable number of releases on Wednesdays. Don’t people work on Thursdays?</p>

<h2 id="analysis-of-frequency-per-week">Analysis of frequency per week</h2>

<p>The world is a big place (or is it a small world?) and earthquakes occur all the time, even though we might not always find out. On the other hand, I would expect that movie releases occur much more frequently. So let’s take a look at the data by plotting histograms for both events side by side.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># joint histograms</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s">'earthquake moving average 8w'</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">9</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s">'movie_release moving average 8w'</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">9</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Histogram of event frequency per week'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c"># With seaborn</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'earthquake moving average 8w'</span><span class="p">]),</span> \
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'movie_release moving average 8w'</span><span class="p">])</span>
</code></pre></div></div>

<p><img src="/images/event-tracker_36_0.png" alt="png" /></p>

<p><img src="/images/event-tracker_36_2.png" alt="png" /></p>

<p>Luckily, movie releases are much more frequent per week as earthquakes. On most weeks, there are between two and three movie releases, compared to 0.5 to 1.5 earthquakes.</p>

<h1 id="final-remarks">Final remarks</h1>

<p>In this post, we gathered information on the occurrence of two events: earthquakes around the world, and movie releases in the US. By plotting their moving averages we could better compare when they occurred and gained some interesting insights about how they compare. All thanks to Python!</p>

  </div></div>

		</section>
	</main></body>
</html>
